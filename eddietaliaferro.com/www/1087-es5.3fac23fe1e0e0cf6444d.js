!function(){"use strict";function e(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function r(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}(self.webpackChunkeddietaliaferro_com=self.webpackChunkeddietaliaferro_com||[]).push([[1087],{1087:function(t,o,s){s.r(o),s.d(o,{UserProfilePageModule:function(){return b}});var i=s(8583),a=s(665),n=s(7823),u=s(1382),l=s(4762),c=s(8720),p=s(1228),d=s(1628),m=s(1311),f=s(6686);function h(e,r){if(1&e&&c._UZ(0,"img",16),2&e){var t=c.oxw();c.s9C("src",t.userPicture,c.LSH)}}function g(e,r){if(1&e&&c._UZ(0,"img",17),2&e){var t=c.oxw();c.s9C("src",t.pictureDataURL,c.LSH)}}var w,P=[{path:"",component:(w=function(){function t(r,o,s,i,a,n,u){e(this,t),this.auth=r,this.storage=o,this.pictureService=s,this.formBuilder=i,this.alertController=a,this.toastController=n,this.helper=u,this.TOKEN_KEY="access_token"}var o,s,i;return o=t,(s=[{key:"ngOnInit",value:function(){var e=this;this.storage.get(this.TOKEN_KEY).then(function(r){var t=e.helper.decodeToken(r);console.clear(),console.log(t)}),this.userFullName=this.auth.userFullName.subscribe(function(r){e.userFirstName=r.split(" ")[0],e.userLastName=r.split(" ")[1],console.log(e.userFirstName),console.log(e.userLastName)}),this.auth.userPicture.subscribe(function(r){console.log(r),e.userPicture=r}),this.auth.userEmail.subscribe(function(r){return console.log(r),e.userEmail=r}),this.userProfileForm=this.formBuilder.group({firstName:["",[a.kI.required]],lastName:["",[a.kI.required]],picture:["",[a.kI.required]],email:["",[a.kI.required]],oldEmail:[this.userEmail,[a.kI.required]],password:["",[a.kI.required]]}),this.userProfileForm.patchValue({firstName:this.userFirstName,lastName:this.userLastName,email:this.userEmail})}},{key:"editProfile",value:function(){var e=this;if(""===this.userProfileForm.value.password)return this.wrongPasswordAlert("You forgot to enter a password!");if(this.userProfileForm.value.email===this.userEmail){console.log("There emails were the same!"),this.pictureDataURL||this.auth.updateProfile({fullName:this.userProfileForm.value.firstName+" "+this.userProfileForm.value.lastName,oldEmail:this.userEmail,newEmail:this.userProfileForm.value.email,password:this.userProfileForm.value.password,picture:this.userPicture}).subscribe(function(r){console.log("Change Picture Update Profile Data: "),console.log(r),!0===r.isMatch&&(e.storage.remove(e.TOKEN_KEY),e.auth.userFullName.next(r.fullName),e.auth.userEmail.next(r.newEmail),e.auth.userPicture.next(r.picture),e.successToast("You have successfully updated your profile!"),e.userProfileForm.patchValue({password:""}))}),console.log("Getting Thumbnail S3 URL");var r=new FormData,t=new File([this.dataURLtoBlob(this.pictureDataURL)],"user-profile-picture.png");r.append("user-profile-picture",t),this.pictureService.userProfilePictureUpload(r).subscribe(function(r){e.userProfileForm.value.picture=r.objectUrl,console.clear(),console.log("USER EMAIL"),console.log(e.userEmail),e.auth.updateProfile({fullName:e.userProfileForm.value.firstName+" "+e.userProfileForm.value.lastName,oldEmail:e.userEmail,newEmail:e.userProfileForm.value.email,password:e.userProfileForm.value.password,picture:e.userProfileForm.value.picture}).subscribe(function(r){console.log(r),!0===r.isMatch&&(e.storage.remove(e.TOKEN_KEY),e.auth.userFullName.next(r.fullName),e.auth.userEmail.next(r.newEmail),e.auth.userPicture.next(r.picture),e.successToast("You have successfully updated your profile!"),e.userProfileForm.patchValue({password:""}))})})}else console.log("The emails were not the same"),this.auth.checkEmail(this.userProfileForm.value.email).subscribe(function(r){if(r.isEmail)console.log("SOMEONE HAS THIS EMAIL! Retry");else if(console.log("No one else has this email!"),e.pictureDataURL){console.log("Getting Thumbnail S3 URL");var t=new FormData,o=new File([e.dataURLtoBlob(e.pictureDataURL)],"user-profile-picture.png");t.append("user-profile-picture",o),e.pictureService.userProfilePictureUpload(t).subscribe(function(r){e.userProfileForm.value.picture=r.objectUrl,e.auth.updateProfile({fullName:e.userProfileForm.value.firstName+" "+e.userProfileForm.value.lastName,oldEmail:e.userEmail,newEmail:e.userProfileForm.value.email,password:e.userProfileForm.value.password,picture:e.userProfileForm.value.picture}).subscribe(function(r){console.log(r),!0===r.isMatch&&(e.auth.userFullName.next(r.fullName),e.auth.userEmail.next(r.email),e.auth.userPicture.next(r.picture),e.successToast("You have successfully updated your profile!"),e.userProfileForm.value.password="")})})}else{var s={fullName:e.userProfileForm.value.firstName+" "+e.userProfileForm.value.lastName,oldEmail:e.userEmail,newEmail:e.userProfileForm.value.email,password:e.userProfileForm.value.password,picture:e.userPicture};console.log(s),e.auth.updateProfile(s).subscribe(function(r){console.log(r),!0===r.isMatch&&(e.auth.userFullName.next(r.fullName),e.auth.userEmail.next(r.email),e.auth.userPicture.next(r.picture),e.successToast("You have successfully updated your profile!"),e.userProfileForm.value.password="")})}})}},{key:"getPictureFile",value:function(e){var r=this;document.getElementById("user-current-picture").style.display="none",console.log(e);var t=document.getElementById("user-profile-picture"),o=new FileReader;t&&o.readAsDataURL(e.target.files[0]),o.addEventListener("load",function(){r.pictureDataURL=o.result,console.log(r.pictureDataURL)},!1)}},{key:"dataURLtoBlob",value:function(e){for(var r=e.split(","),t=r[0].match(/:(.*?);/)[1],o=atob(r[1]),s=o.length,i=new Uint8Array(s);s--;)i[s]=o.charCodeAt(s);return new Blob([i],{type:t})}},{key:"changePassword",value:function(){}},{key:"presentAlertPrompt",value:function(e){return(0,l.mG)(this,void 0,void 0,regeneratorRuntime.mark(function r(){var t=this;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.alertController.create({cssClass:"change-password-alert",header:"Change Password",inputs:[{name:"current-password",id:"current-password",type:"password",placeholder:"Password"},{name:"new-password",id:"new-password",type:"password",placeholder:"New Password"},{name:"retype-new-password",id:"retype-new-password",type:"password",placeholder:"Re-Type New Password"}],buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:function(){console.log("Confirm Cancel")}},{text:"Ok",handler:function(r){console.log(r);var o=r["current-password"],s=r["new-password"],i=r["retype-new-password"];return o==s?(console.log("New password cannot be the same as old password"),!1):s!=i?(console.log("New Passwords do not match!"),t.wrongPasswordAlert("New passwords do not match. Please double check both entries."),!1):(t.auth.changePassword(e,o,s).subscribe(function(e){return e?e?(t.successToast("You have successfully changed your password"),void t.alertController.dismiss()):void 0:(console.log(e),void t.wrongPasswordAlert("The password was wrong. Please end your current password again."))}),!1)}}]});case 2:return r.next=4,r.sent.present();case 4:case"end":return r.stop()}},r,this)}))}},{key:"wrongPasswordAlert",value:function(e){return(0,l.mG)(this,void 0,void 0,regeneratorRuntime.mark(function r(){var t,o,s;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.alertController.create({cssClass:"my-custom-class",header:"Wrong Password!",message:e,buttons:["OK"]});case 2:return t=r.sent,r.next=5,t.present();case 5:return r.next=7,t.onDidDismiss();case 7:o=r.sent,s=o.role,console.log("onDidDismiss resolved with role",s);case 10:case"end":return r.stop()}},r,this)}))}},{key:"successToast",value:function(e){return(0,l.mG)(this,void 0,void 0,regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.toastController.create({message:e,duration:2e3});case 2:r.sent.present();case 3:case"end":return r.stop()}},r,this)}))}}])&&r(o.prototype,s),i&&r(o,i),t}(),w.\u0275fac=function(e){return new(e||w)(c.Y36(p.e),c.Y36(d.K),c.Y36(m.G),c.Y36(a.qu),c.Y36(n.Br),c.Y36(n.yF),c.Y36(f.N0))},w.\u0275cmp=c.Xpm({type:w,selectors:[["app-user-profile"]],decls:26,vars:3,consts:[[1,"ion-justify-content-center"],["size-xs","11","size-sm","9","size-md","8","size-lg","6","size-xl","5",1,"page-wrapper","ion-text-center"],["type","file","name","user-profile-picture","id","user-profile-picture",1,"purple-button",2,"margin","3em auto",3,"change"],["id","user-current-picture","width","200","style","border-radius: 200px;","alt","User Profile Picture",3,"src",4,"ngIf"],["id","user-new-picture","width","200","style","border-radius: 200px;","alt","User Profile Picture",3,"src",4,"ngIf"],["for","user-profile-picture"],[1,"red-button",2,"width","200px","margin","3em auto",3,"click"],["size-xs","11","size-sm","9","size-md","8","size-lg","5","size-xl","4",1,"ion-text-center"],[1,"alert"],[3,"formGroup","ngSubmit"],["lines","none"],["formControlName","firstName","type","text","placeholder","First Name"],["formControlName","lastName","type","text","placeholder","Last Name"],["formControlName","email","type","email","placeholder","Email"],["formControlName","password","type","password","placeholder","Password"],["type","submit",1,"green-button",2,"margin","3em auto"],["id","user-current-picture","width","200","alt","User Profile Picture",2,"border-radius","200px",3,"src"],["id","user-new-picture","width","200","alt","User Profile Picture",2,"border-radius","200px",3,"src"]],template:function(e,r){1&e&&(c.TgZ(0,"ion-content"),c.TgZ(1,"ion-grid"),c.TgZ(2,"ion-row",0),c.TgZ(3,"ion-col",1),c.TgZ(4,"input",2),c.NdJ("change",function(e){return r.getPictureFile(e)}),c.qZA(),c.YNc(5,h,1,1,"img",3),c.YNc(6,g,1,1,"img",4),c.TgZ(7,"label",5),c._uU(8,"Change Profile Picture"),c.qZA(),c.TgZ(9,"ion-button",6),c.NdJ("click",function(){return r.presentAlertPrompt(r.userEmail)}),c._uU(10," Change Password "),c.qZA(),c.qZA(),c.TgZ(11,"ion-col",7),c.TgZ(12,"div",8),c.TgZ(13,"p"),c._uU(14,"You can update your profile here! Make sure all your information is correct before making any changes."),c.qZA(),c.qZA(),c.TgZ(15,"form",9),c.NdJ("ngSubmit",function(){return r.editProfile()}),c.TgZ(16,"ion-item",10),c._UZ(17,"ion-input",11),c.qZA(),c.TgZ(18,"ion-item",10),c._UZ(19,"ion-input",12),c.qZA(),c.TgZ(20,"ion-item",10),c._UZ(21,"ion-input",13),c.qZA(),c.TgZ(22,"ion-item",10),c._UZ(23,"ion-input",14),c.qZA(),c.TgZ(24,"ion-button",15),c._uU(25," Edit Profile "),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.qZA()),2&e&&(c.xp6(5),c.Q6J("ngIf",r.userPicture),c.xp6(1),c.Q6J("ngIf",r.pictureDataURL),c.xp6(9),c.Q6J("formGroup",r.userProfileForm))},directives:[n.W2,n.jY,n.Nd,n.wI,i.O5,n.YG,a._Y,a.JL,a.sg,n.Ie,n.pK,n.j9,a.JJ,a.u],styles:[".danger-toast[_ngcontent-%COMP%]{font-weight:600;font-size:21px;width:100%;--background: #FF443B;position:relative;top:150px;color:#fff}.success-toast[_ngcontent-%COMP%]{font-weight:600;font-size:21px;width:100%;--background: #3df63d;position:relative;top:150px;color:#fff}label[_ngcontent-%COMP%]{cursor:pointer;display:block;background:linear-gradient(360deg,#777777 -2%,#333,#777777);width:264px;height:38px;padding:.7em;margin:2.8em auto 1em;border-radius:100px;font-size:.9em;font-weight:500;text-transform:uppercase}.page-wrapper[_ngcontent-%COMP%]{padding-top:6em}@media only screen and (max-width: 800px){.page-wrapper[_ngcontent-%COMP%]{padding-top:8em}}form[_ngcontent-%COMP%]{background:#1805199e;padding:2em;border-radius:5px;box-shadow:1px 1px 10px #000}#user-profile-picture[_ngcontent-%COMP%]{opacity:0;position:absolute;z-index:-1}.alert[_ngcontent-%COMP%]{background-color:#333;border:solid 2px #3cf63c;border-radius:5px;margin:1em auto;padding:.5em}.alert[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1em}.green-button[_ngcontent-%COMP%]{--background: linear-gradient(360deg, #3df63d -2%, #00b400, #3df63d)}.red-button[_ngcontent-%COMP%]{--background: linear-gradient(360deg, #D01801 -2%, #810b00, #D01801)}ion-item[_ngcontent-%COMP%]{margin:1em auto;--highlight-color-focused: #00c400}ion-item[_ngcontent-%COMP%]:focus{margin:1em auto}ion-input[_ngcontent-%COMP%]{border-radius:10px}"]}),w)}],v=function(){var r=function r(){e(this,r)};return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=c.oAB({type:r}),r.\u0275inj=c.cJS({imports:[[u.Bz.forChild(P)],u.Bz]}),r}(),b=function(){var r=function r(){e(this,r)};return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=c.oAB({type:r}),r.\u0275inj=c.cJS({imports:[[i.ez,a.u5,n.Pc,a.UX,v]]}),r}()}}])}();