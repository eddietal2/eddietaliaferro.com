"use strict";(self.webpackChunkeddietaliaferro_com=self.webpackChunkeddietaliaferro_com||[]).push([[1087],{1087:function(e,r,t){t.r(r),t.d(r,{UserProfilePageModule:function(){return w}});var s=t(8583),o=t(665),i=t(7823),a=t(1382),l=t(4762),u=t(8720),n=t(1228),c=t(1628),d=t(1311),p=t(6686);function h(e,r){if(1&e&&u._UZ(0,"img",16),2&e){const e=u.oxw();u.s9C("src",e.userPicture,u.LSH)}}function m(e,r){if(1&e&&u._UZ(0,"img",17),2&e){const e=u.oxw();u.s9C("src",e.pictureDataURL,u.LSH)}}const f=[{path:"",component:(()=>{class e{constructor(e,r,t,s,o,i,a){this.auth=e,this.storage=r,this.pictureService=t,this.formBuilder=s,this.alertController=o,this.toastController=i,this.helper=a,this.TOKEN_KEY="access_token"}ngOnInit(){this.storage.get(this.TOKEN_KEY).then(e=>{const r=this.helper.decodeToken(e);console.clear(),console.log(r)}),this.userFullName=this.auth.userFullName.subscribe(e=>{this.userFirstName=e.split(" ")[0],this.userLastName=e.split(" ")[1],console.log(this.userFirstName),console.log(this.userLastName)}),this.auth.userPicture.subscribe(e=>{console.log(e),this.userPicture=e}),this.auth.userEmail.subscribe(e=>(console.log(e),this.userEmail=e)),this.userProfileForm=this.formBuilder.group({firstName:["",[o.kI.required]],lastName:["",[o.kI.required]],picture:["",[o.kI.required]],email:["",[o.kI.required]],oldEmail:[this.userEmail,[o.kI.required]],password:["",[o.kI.required]]}),this.userProfileForm.patchValue({firstName:this.userFirstName,lastName:this.userLastName,email:this.userEmail})}editProfile(){if(""===this.userProfileForm.value.password)return this.wrongPasswordAlert("You forgot to enter a password!");if(this.userProfileForm.value.email===this.userEmail){console.log("There emails were the same!"),this.pictureDataURL||this.auth.updateProfile({fullName:this.userProfileForm.value.firstName+" "+this.userProfileForm.value.lastName,oldEmail:this.userEmail,newEmail:this.userProfileForm.value.email,password:this.userProfileForm.value.password,picture:this.userPicture}).subscribe(e=>{console.log("Change Picture Update Profile Data: "),console.log(e),!0===e.isMatch&&(this.storage.remove(this.TOKEN_KEY),this.auth.userFullName.next(e.fullName),this.auth.userEmail.next(e.newEmail),this.auth.userPicture.next(e.picture),this.successToast("You have successfully updated your profile!"),this.userProfileForm.patchValue({password:""}))}),console.log("Getting Thumbnail S3 URL");const e=new FormData;let r=new File([this.dataURLtoBlob(this.pictureDataURL)],"user-profile-picture.png");e.append("user-profile-picture",r),this.pictureService.userProfilePictureUpload(e).subscribe(e=>{this.userProfileForm.value.picture=e.objectUrl,console.clear(),console.log("USER EMAIL"),console.log(this.userEmail),this.auth.updateProfile({fullName:this.userProfileForm.value.firstName+" "+this.userProfileForm.value.lastName,oldEmail:this.userEmail,newEmail:this.userProfileForm.value.email,password:this.userProfileForm.value.password,picture:this.userProfileForm.value.picture}).subscribe(e=>{console.log(e),!0===e.isMatch&&(this.storage.remove(this.TOKEN_KEY),this.auth.userFullName.next(e.fullName),this.auth.userEmail.next(e.newEmail),this.auth.userPicture.next(e.picture),this.successToast("You have successfully updated your profile!"),this.userProfileForm.patchValue({password:""}))})})}else console.log("The emails were not the same"),this.auth.checkEmail(this.userProfileForm.value.email).subscribe(e=>{if(e.isEmail)console.log("SOMEONE HAS THIS EMAIL! Retry");else if(console.log("No one else has this email!"),this.pictureDataURL){console.log("Getting Thumbnail S3 URL");const e=new FormData;let r=new File([this.dataURLtoBlob(this.pictureDataURL)],"user-profile-picture.png");e.append("user-profile-picture",r),this.pictureService.userProfilePictureUpload(e).subscribe(e=>{this.userProfileForm.value.picture=e.objectUrl,this.auth.updateProfile({fullName:this.userProfileForm.value.firstName+" "+this.userProfileForm.value.lastName,oldEmail:this.userEmail,newEmail:this.userProfileForm.value.email,password:this.userProfileForm.value.password,picture:this.userProfileForm.value.picture}).subscribe(e=>{console.log(e),!0===e.isMatch&&(this.auth.userFullName.next(e.fullName),this.auth.userEmail.next(e.email),this.auth.userPicture.next(e.picture),this.successToast("You have successfully updated your profile!"),this.userProfileForm.value.password="")})})}else{let e={fullName:this.userProfileForm.value.firstName+" "+this.userProfileForm.value.lastName,oldEmail:this.userEmail,newEmail:this.userProfileForm.value.email,password:this.userProfileForm.value.password,picture:this.userPicture};console.log(e),this.auth.updateProfile(e).subscribe(e=>{console.log(e),!0===e.isMatch&&(this.auth.userFullName.next(e.fullName),this.auth.userEmail.next(e.email),this.auth.userPicture.next(e.picture),this.successToast("You have successfully updated your profile!"),this.userProfileForm.value.password="")})}})}getPictureFile(e){document.getElementById("user-current-picture").style.display="none",console.log(e);const r=document.getElementById("user-profile-picture");let t=new FileReader;r&&t.readAsDataURL(e.target.files[0]),t.addEventListener("load",()=>{this.pictureDataURL=t.result,console.log(this.pictureDataURL)},!1)}dataURLtoBlob(e){const r=e.split(","),t=r[0].match(/:(.*?);/)[1],s=atob(r[1]);let o=s.length;const i=new Uint8Array(o);for(;o--;)i[o]=s.charCodeAt(o);return new Blob([i],{type:t})}changePassword(){}presentAlertPrompt(e){return(0,l.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({cssClass:"change-password-alert",header:"Change Password",inputs:[{name:"current-password",id:"current-password",type:"password",placeholder:"Password"},{name:"new-password",id:"new-password",type:"password",placeholder:"New Password"},{name:"retype-new-password",id:"retype-new-password",type:"password",placeholder:"Re-Type New Password"}],buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:()=>{console.log("Confirm Cancel")}},{text:"Ok",handler:r=>{console.log(r);let t=r["current-password"],s=r["new-password"],o=r["retype-new-password"];return t==s?(console.log("New password cannot be the same as old password"),!1):s!=o?(console.log("New Passwords do not match!"),this.wrongPasswordAlert("New passwords do not match. Please double check both entries."),!1):(this.auth.changePassword(e,t,s).subscribe(e=>e?e?(this.successToast("You have successfully changed your password"),void this.alertController.dismiss()):void 0:(console.log(e),void this.wrongPasswordAlert("The password was wrong. Please end your current password again."))),!1)}}]})).present()})}wrongPasswordAlert(e){return(0,l.mG)(this,void 0,void 0,function*(){const r=yield this.alertController.create({cssClass:"my-custom-class",header:"Wrong Password!",message:e,buttons:["OK"]});yield r.present();const{role:t}=yield r.onDidDismiss();console.log("onDidDismiss resolved with role",t)})}successToast(e){return(0,l.mG)(this,void 0,void 0,function*(){(yield this.toastController.create({message:e,duration:2e3})).present()})}}return e.\u0275fac=function(r){return new(r||e)(u.Y36(n.e),u.Y36(c.K),u.Y36(d.G),u.Y36(o.qu),u.Y36(i.Br),u.Y36(i.yF),u.Y36(p.N0))},e.\u0275cmp=u.Xpm({type:e,selectors:[["app-user-profile"]],decls:26,vars:3,consts:[[1,"ion-justify-content-center"],["size-xs","11","size-sm","9","size-md","8","size-lg","6","size-xl","5",1,"page-wrapper","ion-text-center"],["type","file","name","user-profile-picture","id","user-profile-picture",1,"purple-button",2,"margin","3em auto",3,"change"],["id","user-current-picture","width","200","style","border-radius: 200px;","alt","User Profile Picture",3,"src",4,"ngIf"],["id","user-new-picture","width","200","style","border-radius: 200px;","alt","User Profile Picture",3,"src",4,"ngIf"],["for","user-profile-picture"],[1,"red-button",2,"width","200px","margin","3em auto",3,"click"],["size-xs","11","size-sm","9","size-md","8","size-lg","5","size-xl","4",1,"ion-text-center"],[1,"alert"],[3,"formGroup","ngSubmit"],["lines","none"],["formControlName","firstName","type","text","placeholder","First Name"],["formControlName","lastName","type","text","placeholder","Last Name"],["formControlName","email","type","email","placeholder","Email"],["formControlName","password","type","password","placeholder","Password"],["type","submit",1,"green-button",2,"margin","3em auto"],["id","user-current-picture","width","200","alt","User Profile Picture",2,"border-radius","200px",3,"src"],["id","user-new-picture","width","200","alt","User Profile Picture",2,"border-radius","200px",3,"src"]],template:function(e,r){1&e&&(u.TgZ(0,"ion-content"),u.TgZ(1,"ion-grid"),u.TgZ(2,"ion-row",0),u.TgZ(3,"ion-col",1),u.TgZ(4,"input",2),u.NdJ("change",function(e){return r.getPictureFile(e)}),u.qZA(),u.YNc(5,h,1,1,"img",3),u.YNc(6,m,1,1,"img",4),u.TgZ(7,"label",5),u._uU(8,"Change Profile Picture"),u.qZA(),u.TgZ(9,"ion-button",6),u.NdJ("click",function(){return r.presentAlertPrompt(r.userEmail)}),u._uU(10," Change Password "),u.qZA(),u.qZA(),u.TgZ(11,"ion-col",7),u.TgZ(12,"div",8),u.TgZ(13,"p"),u._uU(14,"You can update your profile here! Make sure all your information is correct before making any changes."),u.qZA(),u.qZA(),u.TgZ(15,"form",9),u.NdJ("ngSubmit",function(){return r.editProfile()}),u.TgZ(16,"ion-item",10),u._UZ(17,"ion-input",11),u.qZA(),u.TgZ(18,"ion-item",10),u._UZ(19,"ion-input",12),u.qZA(),u.TgZ(20,"ion-item",10),u._UZ(21,"ion-input",13),u.qZA(),u.TgZ(22,"ion-item",10),u._UZ(23,"ion-input",14),u.qZA(),u.TgZ(24,"ion-button",15),u._uU(25," Edit Profile "),u.qZA(),u.qZA(),u.qZA(),u.qZA(),u.qZA(),u.qZA()),2&e&&(u.xp6(5),u.Q6J("ngIf",r.userPicture),u.xp6(1),u.Q6J("ngIf",r.pictureDataURL),u.xp6(9),u.Q6J("formGroup",r.userProfileForm))},directives:[i.W2,i.jY,i.Nd,i.wI,s.O5,i.YG,o._Y,o.JL,o.sg,i.Ie,i.pK,i.j9,o.JJ,o.u],styles:[".danger-toast[_ngcontent-%COMP%]{font-weight:600;font-size:21px;width:100%;--background: #FF443B;position:relative;top:150px;color:#fff}.success-toast[_ngcontent-%COMP%]{font-weight:600;font-size:21px;width:100%;--background: #3df63d;position:relative;top:150px;color:#fff}label[_ngcontent-%COMP%]{cursor:pointer;display:block;background:linear-gradient(360deg,#777777 -2%,#333,#777777);width:264px;height:38px;padding:.7em;margin:2.8em auto 1em;border-radius:100px;font-size:.9em;font-weight:500;text-transform:uppercase}.page-wrapper[_ngcontent-%COMP%]{padding-top:6em}@media only screen and (max-width: 800px){.page-wrapper[_ngcontent-%COMP%]{padding-top:8em}}form[_ngcontent-%COMP%]{background:#1805199e;padding:2em;border-radius:5px;box-shadow:1px 1px 10px #000}#user-profile-picture[_ngcontent-%COMP%]{opacity:0;position:absolute;z-index:-1}.alert[_ngcontent-%COMP%]{background-color:#333;border:solid 2px #3cf63c;border-radius:5px;margin:1em auto;padding:.5em}.alert[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1em}.green-button[_ngcontent-%COMP%]{--background: linear-gradient(360deg, #3df63d -2%, #00b400, #3df63d)}.red-button[_ngcontent-%COMP%]{--background: linear-gradient(360deg, #D01801 -2%, #810b00, #D01801)}ion-item[_ngcontent-%COMP%]{margin:1em auto;--highlight-color-focused: #00c400}ion-item[_ngcontent-%COMP%]:focus{margin:1em auto}ion-input[_ngcontent-%COMP%]{border-radius:10px}"]}),e})()}];let g=(()=>{class e{}return e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=u.oAB({type:e}),e.\u0275inj=u.cJS({imports:[[a.Bz.forChild(f)],a.Bz]}),e})(),w=(()=>{class e{}return e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=u.oAB({type:e}),e.\u0275inj=u.cJS({imports:[[s.ez,o.u5,i.Pc,o.UX,g]]}),e})()}}]);